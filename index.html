<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Allocation Calculator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f8f9fa;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: #1a73e8;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .content {
            display: flex;
            gap: 30px;
            padding: 30px;
        }
        
        .left-panel {
            flex: 1;
        }
        
        .right-panel {
            flex: 1;
        }
        
        .investment-input {
            background: #f1f3f4;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .investment-input label {
            font-weight: 600;
            display: block;
            margin-bottom: 8px;
        }
        
        .investment-input input {
            width: 100%;
            padding: 12px;
            border: 2px solid #dadce0;
            border-radius: 4px;
            font-size: 16px;
            box-sizing: border-box;
        }
        
        .investment-input input:focus {
            border-color: #1a73e8;
            outline: none;
        }
        
        .sheet-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .sheet-table th {
            background: #f8f9fa;
            border: 1px solid #dadce0;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            color: #3c4043;
        }
        
        .sheet-table td {
            border: 1px solid #dadce0;
            padding: 8px;
            vertical-align: middle;
        }
        
        .sheet-table tr:nth-child(even) {
            background: #fafafa;
        }
        
        .asset-name {
            font-weight: 500;
            min-width: 180px;
        }
        
        .percentage-input {
            width: 70px;
            padding: 6px;
            border: 1px solid #dadce0;
            border-radius: 3px;
            text-align: right;
        }
        
        .percentage-input:focus {
            border-color: #1a73e8;
            outline: none;
        }
        
        .normalized {
            font-weight: 500;
            color: #1a73e8;
        }
        
        .amount {
            font-weight: 500;
            color: #137333;
            text-align: right;
        }
        
        .summary {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .total-row {
            font-weight: 600;
            border-top: 2px solid #dadce0;
            padding-top: 5px;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin-top: 20px;
        }
        
        .warning {
            background: #fef7e0;
            border: 1px solid #f9ab00;
            color: #b06000;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            display: none;
        }
        
        h1 {
            margin: 0;
            font-size: 24px;
        }
        
        h2 {
            color: #3c4043;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .instructions {
            background: #e8f0fe;
            border: 1px solid #1a73e8;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 20px;
            color: #1a73e8;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Portfolio Allocation Calculator</h1>
            <p>Enter your desired percentages - they'll be automatically normalized to 100%</p>
        </div>
        
        <div class="content">
            <div class="left-panel">
                <div class="investment-input">
                    <label for="totalAmount">Total Investment Amount (₹)</label>
                    <input type="number" id="totalAmount" value="100000" min="0" step="1000">
                </div>
                
                <div class="instructions">
                    <strong>How to use:</strong><br>
                    • Enter percentages in the "Your %" column<br>
                    • "Normalized %" shows actual allocation (always totals 100%)<br>
                    • Dollar amounts update automatically<br>
                    • <strong>To add asset classes:</strong> Edit the 'assetClasses' array in the code
                </div>
                
                <div class="add-asset" style="background: #f0f4ff; border: 1px solid #4285f4; border-radius: 4px; padding: 15px; margin-bottom: 15px;">
                    <strong>Add New Asset Class:</strong><br>
                    <input type="text" id="newAssetName" placeholder="Enter asset class name" style="width: 200px; padding: 8px; margin: 8px 8px 8px 0; border: 1px solid #dadce0; border-radius: 3px;">
                    <button onclick="addAssetClass()" style="padding: 8px 16px; background: #4285f4; color: white; border: none; border-radius: 3px; cursor: pointer;">Add Asset</button>
                    <button onclick="removeLastAsset()" style="padding: 8px 16px; background: #ea4335; color: white; border: none; border-radius: 3px; cursor: pointer; margin-left: 8px;">Remove Last</button>
                </div>
                
                <div class="warning" id="warning">
                    ⚠️ Your percentages don't add up to 100%. See normalized column for actual allocation.
                </div>
                
                <table class="sheet-table">
                    <thead>
                        <tr>
                            <th>Asset Class</th>
                            <th>Your %</th>
                            <th>Normalized %</th>
                            <th>Amount (₹)</th>
                        </tr>
                    </thead>
                    <tbody id="assetTable">
                        <!-- Populated by JavaScript -->
                    </tbody>
                </table>
                
                <div class="summary">
                    <div class="summary-row">
                        <span>Total Input Percentage:</span>
                        <span id="totalPercentage">0%</span>
                    </div>
                    <div class="summary-row">
                        <span>Normalized Total:</span>
                        <span>100%</span>
                    </div>
                    <div class="summary-row total-row">
                        <span>Total Investment:</span>
                        <span id="totalInvestment">₹1,00,000</span>
                    </div>
                </div>
            </div>
            
            <div class="right-panel">
                <h2>Portfolio Allocation</h2>
                <div class="chart-container">
                    <canvas id="pieChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        let assetClasses = [
            'Small Cap Stocks',
            'Large Cap Stocks',
            'US Stocks',
            'Small Cap Mutual Funds',
            'Multi Cap Mutual Funds',
            'Gold ETFs',
            'Physical Gold',
            'Fixed Deposits',
            'Bonds',
            'Liquid Cash'
        ];

        let chart;
        const colors = [
            '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF',
            '#FF9F40', '#FF6384', '#C9CBCF', '#4BC0C0', '#36A2EB',
            '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7',
            '#DDA0DD', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E9'
        ];

        function addAssetClass() {
            const newAssetName = document.getElementById('newAssetName').value.trim();
            if (newAssetName && !assetClasses.includes(newAssetName)) {
                assetClasses.push(newAssetName);
                document.getElementById('newAssetName').value = '';
                initializeTable();
                updateCalculations();
            }
        }

        function removeLastAsset() {
            if (assetClasses.length > 1) {
                assetClasses.pop();
                initializeTable();
                updateCalculations();
            }
        }

        function initializeTable() {
            const tbody = document.getElementById('assetTable');
            tbody.innerHTML = '';

            assetClasses.forEach((asset, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="asset-name">${asset}</td>
                    <td><input type="number" class="percentage-input" id="input-${index}" value="10" min="0" max="100" step="0.1"></td>
                    <td class="normalized" id="normalized-${index}">10.00%</td>
                    <td class="amount" id="amount-${index}">₹10,000</td>
                `;
                tbody.appendChild(row);
            });

            // Add event listeners
            assetClasses.forEach((_, index) => {
                document.getElementById(`input-${index}`).addEventListener('input', updateCalculations);
            });

            document.getElementById('totalAmount').addEventListener('input', updateCalculations);
        }

        function updateCalculations() {
            const totalAmount = parseFloat(document.getElementById('totalAmount').value) || 0;
            let inputValues = [];
            let totalInputPercentage = 0;

            // Collect input values
            assetClasses.forEach((_, index) => {
                const value = parseFloat(document.getElementById(`input-${index}`).value) || 0;
                inputValues.push(value);
                totalInputPercentage += value;
            });

            // Update total percentage display
            document.getElementById('totalPercentage').textContent = `${totalInputPercentage.toFixed(1)}%`;
            document.getElementById('totalInvestment').textContent = `₹${totalAmount.toLocaleString('en-IN')}`;

            // Show/hide warning
            const warning = document.getElementById('warning');
            if (Math.abs(totalInputPercentage - 100) > 0.1 && totalInputPercentage > 0) {
                warning.style.display = 'block';
            } else {
                warning.style.display = 'none';
            }

            // Calculate normalized percentages and amounts
            const chartData = [];
            const chartLabels = [];
            const chartColors = [];

            assetClasses.forEach((asset, index) => {
                let normalizedPercentage = 0;
                if (totalInputPercentage > 0) {
                    normalizedPercentage = (inputValues[index] / totalInputPercentage) * 100;
                }

                const amount = (normalizedPercentage / 100) * totalAmount;

                // Update display
                document.getElementById(`normalized-${index}`).textContent = `${normalizedPercentage.toFixed(2)}%`;
                document.getElementById(`amount-${index}`).textContent = `₹${amount.toLocaleString('en-IN', {minimumFractionDigits: 0, maximumFractionDigits: 0})}`;

                // Prepare chart data (only include non-zero values)
                if (normalizedPercentage > 0) {
                    chartData.push(normalizedPercentage);
                    chartLabels.push(asset);
                    chartColors.push(colors[index]);
                }
            });

            updateChart(chartLabels, chartData, chartColors);
        }

        function updateChart(labels, data, colors) {
            if (chart) {
                chart.destroy();
            }

            const ctx = document.getElementById('pieChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const percentage = context.parsed.toFixed(2);
                                    const totalAmount = parseFloat(document.getElementById('totalAmount').value) || 0;
                                    const amount = (context.parsed / 100) * totalAmount;
                                    return `${context.label}: ${percentage}% (₹${amount.toLocaleString('en-IN', {minimumFractionDigits: 0, maximumFractionDigits: 0})})`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Initialize the application
        window.addEventListener('load', function() {
            initializeTable();
            updateCalculations();
        });
    </script>
</body>
</html>